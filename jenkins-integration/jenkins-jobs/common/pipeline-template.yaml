- job-template:
    name: '{task}-{name}-010-provision-sut'
    parameters:
    - string:
      name: SUT_HOST
      description: "The hostname/ip address of the SUT host"
      default: "puppetserver-perf-sut54.delivery.puppetlabs.net"

    builders:
      - shell: |
          #!/usr/bin/env bash

          echo "Hi!  TODO: I should be provisioning your SUT, but I'm not!"

    publishers:
      - trigger-parameterized-builds:
        - project: '{task}-{name}-020-install-pe'

- job-template:
    name: '{task}-{name}-020-install-pe'

    builders:
      - shell: |
          #!/usr/bin/env bash

          pushd jenkins-integration
          source ./jenkins-jobs/common/scripts/initialize_ruby_env.sh
          ./jenkins-jobs/common/scripts/setup_beaker_env.sh
          ./jenkins-jobs/ops-deployment/setup_master.sh
          popd
    publishers:
      - trigger-parameterized-builds:
        - project: '{task}-{name}-030-customize-settings'

- job-template:
    name: '{task}-{name}-030-customize-settings'

    builders:
      - shell: |
          #!/usr/bin/env bash

          echo "Hi!  I should be customizing settings on your SUT, but I'm not!"

    publishers:
      - trigger-parameterized-builds:
        - project: '{task}-{name}-040-install-puppet-code'

- job-template:
    name: '{task}-{name}-040-install-puppet-code'

    builders:
      - shell: |
          #!/usr/bin/env bash

          pushd jenkins-integration
          ./jenkins-jobs/common/scripts/install_puppet_code.sh
          popd
    publishers:
      - trigger-parameterized-builds:
        - project: '{task}-{name}-050-file-sync'

- job-template:
    name: '{task}-{name}-050-file-sync'

    builders:
      - shell: |
          #!/usr/bin/env bash

          pushd jenkins-integration
          ./jenkins-jobs/common/scripts/file_sync.sh
          popd
    publishers:
      - trigger-parameterized-builds:
        - project: '{task}-{name}-060-classify-nodes'

- job-template:
    name: '{task}-{name}-060-classify-nodes'

    builders:
      - shell: |
          #!/usr/bin/env bash

          pushd jenkins-integration
          ./jenkins-jobs/common/scripts/classify_nodes.sh
          popd
    publishers:
      - trigger-parameterized-builds:
        - project: '{task}-{name}-070-validate-classification'

- job-template:
    name: '{task}-{name}-070-validate-classification'

    builders:
      - shell: |
          #!/usr/bin/env bash

          echo "Hi!  TODO: I should be validating classification on your SUT, but I'm not!"

    publishers:
      - trigger-parameterized-builds:
        - project: '{task}-{name}-080-launch-bg-scripts'

- job-template:
    name: '{task}-{name}-080-launch-bg-scripts'

    builders:
      - shell: |
          #!/usr/bin/env bash

          echo "Hi!  TODO: I should be launching background scripts on your SUT, but I'm not!"

    publishers:
      - trigger-parameterized-builds:
        - project: '{task}-{name}-090-run-gatling-sim'

- job-template:
    name: '{task}-{name}-090-run-gatling-sim'

    builders:
      - shell: |
          #!/usr/bin/env bash

          pushd jenkins-integration
          ./jenkins-jobs/common/scripts/run_simulation.sh
          popd
    publishers:
      - trigger-parameterized-builds:
        - project: '{task}-{name}-100-collect-artifacts'

- job-template:
    name: '{task}-{name}-100-collect-artifacts'

    builders:
      - shell: |
          #!/usr/bin/env bash

          echo "Hi!  TODO: I should be collecting reports / artifacts for your perf test, but I'm not!"

- job-group:
    name: "{task}-{name}-pipeline"
    jobs:
      - "{task}-{name}-010-provision-sut"
      - "{task}-{name}-020-install-pe"
      - "{task}-{name}-030-customize-settings"
      - "{task}-{name}-040-install-puppet-code"
      - "{task}-{name}-050-file-sync"
      - "{task}-{name}-060-classify-nodes"
      - "{task}-{name}-070-validate-classification"
      - "{task}-{name}-080-launch-bg-scripts"
      - "{task}-{name}-090-run-gatling-sim"
      - "{task}-{name}-100-collect-artifacts"
